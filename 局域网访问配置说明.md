# UDBM 局域网访问配置说明

## 概述

本文档说明如何配置UDBM项目以支持局域网访问，让同事能够通过局域网访问您本机运行的应用服务。

## 快速启动

### 方法一：使用局域网启动脚本（推荐）

```bash
# 进入项目目录
cd /Users/isadmin/StudyCursor/UDBM

# 使用局域网启动脚本
./start-lan.sh
```

### 方法二：使用主启动脚本

```bash
# 进入项目目录
cd /Users/isadmin/StudyCursor/UDBM

# 使用局域网模式启动
./start-project.sh start --lan
```

## 配置说明

### 1. 后端CORS配置

后端已配置支持局域网访问的CORS设置：

```python
# 在 udbm-backend/app/main.py 中
app.add_middleware(
    CORSMiddleware,
    allow_origins=[
        "http://localhost:3000", 
        "http://localhost:3001", 
        "http://127.0.0.1:3000",
        "http://0.0.0.0:3000",
        # 支持局域网访问 - 允许所有192.168.x.x和10.x.x.x网段
        "http://192.168.0.0/16",
        "http://10.0.0.0/8",
        "http://172.16.0.0/12",
        # 支持所有来源（开发环境）
        "*"
    ],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

### 2. 前端API配置

前端会根据启动模式自动配置API基础URL：

- **本地模式**: `http://localhost:8000/api/v1`
- **局域网模式**: `http://[本机IP]:8000/api/v1`

### 3. 端口配置

- **前端端口**: 3000
- **后端端口**: 8000

## 访问地址

启动成功后，您会看到以下访问地址：

### 本机访问
- 前端: http://localhost:3000
- 后端API: http://localhost:8000
- API文档: http://localhost:8000/docs

### 局域网访问
- 前端: http://[您的IP地址]:3000
- 后端API: http://[您的IP地址]:8000
- API文档: http://[您的IP地址]:8000/docs

## 同事访问步骤

1. **确保网络连接**
   - 确保同事与您在同一局域网内
   - 确保网络连接正常

2. **获取您的IP地址**
   - 启动脚本会自动显示您的IP地址
   - 或者手动查看：`ifconfig` (macOS) 或 `ip addr` (Linux)

3. **访问应用**
   - 同事在浏览器中访问：`http://[您的IP地址]:3000`
   - 例如：`http://192.168.1.100:3000`

## 防火墙配置

### macOS 防火墙配置

如果同事无法访问，可能需要配置macOS防火墙：

```bash
# 检查防火墙状态
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --getglobalstate

# 允许Python访问
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --add /usr/bin/python3

# 允许Node.js访问
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --add /usr/local/bin/node

# 或者临时关闭防火墙（不推荐）
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --setglobalstate off
```

### Linux 防火墙配置

```bash
# Ubuntu/Debian
sudo ufw allow 3000
sudo ufw allow 8000

# CentOS/RHEL
sudo firewall-cmd --permanent --add-port=3000/tcp
sudo firewall-cmd --permanent --add-port=8000/tcp
sudo firewall-cmd --reload
```

## 故障排除

### 1. 无法获取IP地址

如果脚本无法自动获取IP地址，可以手动设置：

```bash
# 查看网络接口
ifconfig

# 手动指定IP地址（在启动脚本中修改）
export LOCAL_IP="192.168.1.100"
```

### 2. 端口被占用

```bash
# 查看端口占用情况
lsof -i :3000
lsof -i :8000

# 强制清理端口
./start-project.sh start --lan --force
```

### 3. 同事无法访问

1. **检查网络连通性**
   ```bash
   # 在同事机器上ping您的IP
   ping [您的IP地址]
   ```

2. **检查端口是否开放**
   ```bash
   # 在同事机器上测试端口
   telnet [您的IP地址] 3000
   telnet [您的IP地址] 8000
   ```

3. **检查防火墙设置**
   - 确保防火墙允许相应端口的访问
   - 检查路由器是否阻止了端口访问

### 4. CORS错误

如果出现CORS错误，检查后端CORS配置是否正确，确保包含了同事的IP地址段。

## 安全注意事项

1. **仅限开发环境使用**
   - 当前配置允许所有来源访问，仅适用于开发环境
   - 生产环境需要限制允许的IP地址范围

2. **网络安全**
   - 确保局域网环境安全
   - 避免在公共网络中使用此配置

3. **访问控制**
   - 考虑添加身份验证机制
   - 限制敏感操作的访问权限

## 常用命令

```bash
# 启动局域网模式
./start-lan.sh

# 启动局域网模式（主脚本）
./start-project.sh start --lan

# 查看服务状态
./start-project.sh status

# 查看日志
./start-project.sh logs

# 停止服务
./start-project.sh stop

# 重启服务
./start-project.sh restart
```

## 联系支持

如果遇到问题，请检查：

1. 网络连接是否正常
2. 防火墙设置是否正确
3. 端口是否被占用
4. IP地址是否正确

更多技术支持，请查看项目README或联系开发团队。
